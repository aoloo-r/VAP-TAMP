# Encoder setup
encoder: "siglip"
encoder_args:
  version: "so400m"
  feature_match_threshold: 0.05
  grasp_feature_match_threshold: 0.05
open_vocab_category_map_file: example_cat_map.json
tts_engine: "gTTS"

# --- MODIFIED: Sparse Voxel Map parameters for iPhone LiDAR ---
voxel_size: 0.04
obs_min_height: 0.05  # Lowered to catch things on the floor
obs_max_height: 2.5   # Increased to capture more of the room height
neg_obs_height: -0.05
use_negative_obstacles: True
obs_min_density: 5    # Lowered to be less strict
min_points_per_voxel: 5 # Lowered from 20 to accept more points

pad_obstacles: 2 # Reduced padding slightly
min_pad_obstacles: 1

local_radius: 0.8
add_local_every_step: False
remove_visited_from_obstacles: False
min_depth: 0.1  # CHANGED: Lowered from 0.5 to 0.1 to include close objects
max_depth: 5.0  # CHANGED: Increased from 2.0 to 5.0 to include more of the room

# Object detection parameters
detection:
  module: "detic"
  yolo_world_model_size: "l"
  yolo_confidence_threshold: 0.1
  confidence_threshold: 0.5
  category_map_file: example_cat_map.json
  use_detic_viz: False

# --- MODIFIED: Point cloud cleanup filters ---
filters:
  # Turned off aggressive smoothing to preserve detail
  smooth_kernel_size: 0
  use_median_filter: False # Disabled median filter
  median_filter_size: 4
  median_filter_max_error: 0.01
  use_derivative_filter: False
  derivative_filter_threshold: 0.1

# ... (rest of the file remains the same)
motion:
  moving_threshold: 0.01
  angle_threshold: 0.1
  min_steps_not_moving: 2
  joint_tolerance:
    arm: 0.02
    base_x: 0.02
    lift: 0.02
    wrist_roll: 0.1
    wrist_pitch: 0.1
    wrist_yaw: 0.1
    head_pan: 0.01
    head_tilt: 0.01
  joint_thresholds:
    head_not_moving_tolerance: 1.0e-4
    gripper_open_threshold: 0.3

# Exploration
agent:
  realtime:
    matching_distance: 0.5
    temporal_threshold: 0.1
    maximum_matched_observations: 50
    camera_pose_match_threshold: 0.5
  
  use_realtime_updates: False
  realtime_rotation_steps: 2

  in_place_rotation_steps: 8
  sweep_head_on_update: False

# Instance memory parameters
instance_memory:
  min_instance_thickness: 0.02
  min_instance_vol: 5e-6
  max_instance_vol: 10.0
  min_instance_height: 0.05
  max_instance_height: 1.8
  min_pixels_for_instance_view: 200
  min_percent_for_instance_view: 0.15
  mask_cropped_instances: False
  
  matching:
    box_min_iou_thresh: 0.02
    min_similarity_thresh: 0.25
    box_overlap_weight: 0.2
    visual_similarity_weight: 0.5
    shape_similarity_weight: 0.3
    use_shape_matching: true
    shape_tolerance: 0.3
  
  deduplication:
    small_object_threshold: 0.001
    medium_object_threshold: 0.01
    large_object_threshold: 0.1
    
    small_object_distance: 0.20
    medium_object_distance: 0.30
    large_object_distance: 0.45
    
    min_merge_distance: 0.10

# TAMP parameters
guarantee_instance_is_reachable: True
use_scene_graph: True
scene_graph:
  max_near_distance: 0.3
  min_on_height: 0.05
  max_on_height: 0.2
  max_beside_distance: 0.4
  max_beside_height_diff: 0.1
  max_under_distance: 0.5
  min_under_height: 0.3
  max_above_distance: 0.4
  min_above_height: 0.15
  max_inside_distance: 0.2
  max_against_distance: 0.15
  max_next_to_distance: 0.25
  min_behind_distance: 0.1
  max_behind_distance: 0.6

# Navigation space
motion_planner:
  step_size: 0.05
  rotation_step_size: 0.1
  algorithm: "rrt_connect"
  max_iter: 2000  # Increased from default 100 to allow more complex planning
  is_safe_threshold: 0.0  # Allow robot to navigate without requiring explored space (debug mode)
  simplify_plans: True
  shortcut_plans: True
  simplify:
    max_step: 0.5
    min_step: 0.05
    num_steps: 8
    min_angle: 0.1
  shortcut_iter: 100
  frontier:
    dilate_frontier_size: 2
    dilate_obstacle_size: 4
    default_expand_frontier_size: 12
    min_dist: 0.1
    step_dist: 0.2
  goals:
    manipulation_radius: 0.45

trajectory_pos_err_threshold: 0.15
trajectory_rot_err_threshold: 0.5
trajectory_per_step_timeout: 3.0

# User interface
exploration_steps: 50
name: "stretch"